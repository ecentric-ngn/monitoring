<form #form="ngForm">
  <div class="p-3">
    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">Installation of Project Sign Board:<span
            class="text-danger font-size-12">*</span></label>
        <select class="form-select form-control-sm" [(ngModel)]="formData.projectSignBoard" name="projectSignBoard"
          required #projectSignBoard="ngModel" [disabled]="appNoStatus === 'REJECTED'">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Not Available">NA</option>
        </select>
        <div *ngIf="projectSignBoard.invalid && projectSignBoard.touched" class="text-danger font-size-12">
          Please select an option for Project Sign Board
        </div>
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Site Office:<span class="text-danger font-size-12">*</span></label>
        <select class="form-select form-control-sm" [(ngModel)]="formData.siteOffice" name="siteOffice" required
          #siteOffice="ngModel" [disabled]="appNoStatus === 'REJECTED'">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Not Available">NA</option>
        </select>
        <div *ngIf="siteOffice.invalid && siteOffice.touched" class="text-danger font-size-12">
          Please select an option for Site Office
        </div>
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Site Store:<span class="text-danger font-size-12">*</span></label>
        <select class="form-select form-control-sm" [(ngModel)]="formData.siteStore" name="siteStore" required
          #siteStore="ngModel" [disabled]="appNoStatus === 'REJECTED'">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Not Available">NA</option>
        </select>
        <div *ngIf="siteStore.invalid && siteStore.touched" class="text-danger font-size-12">
          Please select an option for Site Store
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">Habitable Workers Accommodation:<span
            class="text-danger font-size-12">*</span></label>
        <select class="form-select form-control-sm " [(ngModel)]="formData.workerAccommodation"
          name="workerAccommodation" required #workerAccommodation="ngModel" [disabled]="appNoStatus === 'REJECTED'">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Not Available">NA</option>
        </select>
        <div *ngIf="workerAccommodation.invalid && workerAccommodation.touched" class="text-danger font-size-12">
          Please select an option for Worker Accommodation
        </div>
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Proper sanitation facilities:<span class="text-danger font-size-12">*</span></label>
        <select class="form-select form-control-sm" [(ngModel)]="formData.sanitationFacilities"
          name="sanitationFacilities" required #sanitationFacilities="ngModel" [disabled]="appNoStatus === 'REJECTED'">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Not Available">NA</option>
        </select>
        <div *ngIf="sanitationFacilities.invalid && sanitationFacilities.touched" class="text-danger font-size-12">
          Please select an option for Sanitation Facilities
        </div>
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Access to potable water:<span class="text-danger font-size-12">*</span></label>
        <select class="form-select form-control-sm" [(ngModel)]="formData.potableWater" name="potableWater" required
          #potableWater="ngModel" [disabled]="appNoStatus === 'REJECTED'">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Not Available">NA</option>
        </select>
        <div *ngIf="potableWater.invalid && potableWater.touched" class="text-danger font-size-12">
          Please select an option for Potable Water
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">APS maintained by the Procuring Agency:<span
            class="text-danger font-size-12">*</span></label>
        <select class="form-select form-control-sm" [(ngModel)]="formData.apsMaintained" name="papsMaintained" required
          #papsMaintained="ngModel" [disabled]="appNoStatus === 'REJECTED'">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Not Available">NA</option>
        </select>
        <div *ngIf="papsMaintained.invalid && papsMaintained.touched" class="text-danger font-size-12">
          Please select an option for PAPS
        </div>
      </div>

      <div class="col-md-4 mb-3">
        <label class="form-label">Project start-up and site meetings doc:<span
            class="text-danger font-size-12">*</span></label>
        <select class="form-select form-control-sm" [(ngModel)]="formData.siteMeetingDocumented"
          name="siteMeetingDocumented" required #siteMeetingDocumented="ngModel"
          [disabled]="appNoStatus === 'REJECTED'">
          <option value="">-- Select --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Not Available">NA</option>
        </select>
        <div *ngIf="siteMeetingDocumented.invalid && siteMeetingDocumented.touched" class="text-danger font-size-12">
          Please select an option for Site Meeting Documentation
        </div>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label mb-2">Upload Files</label>
        <div *ngFor="let fileInput of fileInputs; let i = index" class="row g-2 align-items-end mb-2 border rounded">
          <!-- File input -->
          <div class="col-9">
            <input type="file" class="form-control form-control-sm" (change)="onFileSelected($event, i)"
              [class.is-invalid]="fileErrors[i]" [disabled]="appNoStatus === 'REJECTED'" />
            <div *ngIf="fileErrors[i]" class="text-danger small mt-1">
              {{ fileErrors[i] }}
            </div>
          </div>

          <!-- Action buttons -->
          <div class="col-3 d-flex flex-column gap-2">
            <!-- "Add More" for the first row only -->
            <button *ngIf="i === 0" type="button" class="btn btn-outline-primary btn-sm" (click)="addFileInput()"
              [disabled]="appNoStatus === 'REJECTED'">
              <i class="pi pi-plus me-1"></i> More
            </button>

            <!-- "Remove" for all other rows -->
            <button *ngIf="fileInputs.length > 1 && i !== 0" type="button" class="btn btn-outline-danger btn-sm"
              (click)="removeFileInput(i)">
              <i class="pi pi-trash me-1"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="col-md-4" *ngIf="formData.filePathList && formData.filePathList.length > 0">
        <label class="form-label me-2 font-size-12">Uploaded Documents:</label>
        <div class="flex-wrap align-items-center gap-2 flex-column">
          <!-- Show if at least one file is valid -->
          <ng-container *ngIf="!formData.allPathsNoFile; else noFileTemplate">
            <ng-container *ngFor="let filePath of formData.filePathList; let i = index">
              <div *ngIf="filePath !== 'NO_PATH'" class="d-flex align-items-center gap-2 mb-1">
                <button class="btn btn-outline-primary btn-sm" (click)="viewFile(filePath)">
                  <i class="bi bi-eye me-1"></i> View Doc
                </button>
                <a nz-popconfirm [nzPopconfirmTitle]="'Do you want to delete this file?'"
                  [nzPopconfirmPlacement]="'topRight'" (nzOnConfirm)="deleteFile(formData.fileIdList[i], i)">
                  <button class="btn btn-outline-danger btn-sm">
                    <i class="bi bi-trash me-1"></i> Delete
                  </button>
                </a>
              </div>
            </ng-container>
          </ng-container>
          <!-- Show when all paths are NO_PATH -->
          <ng-template #noFileTemplate>
            <span class="text-muted">No file uploaded</span>
          </ng-template>
        </div>
      </div>

    </div>
    <div class="row">
      <div class="col-md-12 mb-3">
        <label class="form-label">Project start-up meeting Remarks:<span
            class="text-danger font-size-12">*</span></label>
        <textarea class="form-control" placeholder="Enter remarks" [(ngModel)]="formData.meetingRemarks"
          name="meetingRemarks" required #meetingRemarks="ngModel"></textarea>
        <div *ngIf="meetingRemarks.invalid && meetingRemarks.touched" class="text-danger font-size-12">
          Please enter remarks.
        </div>
      </div>
    </div>
  </div>
  <div class="justify-content-end d-flex">
    <button *ngIf="workType === 'OTHERS'" class="btn mr-1 text-white prev-btn" type="submit"
      (click)="onPreviousClick()">Prev</button>
    <button class="btn text-white save-next-btn" (click)="saveAndNext(form)" type="submit">Save & Next</button>
  </div>
</form>